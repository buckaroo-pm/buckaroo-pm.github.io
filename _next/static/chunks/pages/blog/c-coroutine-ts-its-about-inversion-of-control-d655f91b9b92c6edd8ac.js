_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[16],{YoLn:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return m})),t.d(a,"default",(function(){return l}));var n=t("rePB"),c=t("Ff2n"),o=(t("q1tI"),t("7ljp")),s=t("ZDfL");function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function r(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){Object(n.a)(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}var m={title:"C++ Coroutine TS\u200a\u2014\u200aIt\u2019s about inversion of control!",summary:"This article gives you one motivating example where lazy sequences enable you to *seperate your concerns* and maximize code reuse without increasing complexity.",created:"2018-11-09T11:00:00.000Z",author:"Team Buckaroo",banner:"/posts/coroutine.jpeg",attribution:"\u201cperson flip skiing above snow during daytime\u201d by J\xf6rg Angeli on Unsplash",__resourcePath:"blog/c-coroutine-ts-its-about-inversion-of-control.md",__scans:{},layout:"index"},N={frontMatter:m},u=s.a;function l(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(o.a)(u,r(r(r({},N),t),{},{components:a,mdxType:"MDXLayout"}),Object(o.a)("p",null,"C++ Coroutine TS \u2014 It\u2019s about inversion of control!"),Object(o.a)("p",null,"Many people look at the Coroutines TS and wonder, what is all of the fuss about?"),Object(o.a)("p",null,"This article gives you one motivating example where lazy sequences enable you to ",Object(o.a)("em",{parentName:"p"},"seperate your concerns")," and maximize code reuse without increasing complexity."),Object(o.a)("h2",null,Object(o.a)("strong",{parentName:"h2"},"Example: Approximating the Golden Ratio")),Object(o.a)("p",null,"Every Math student knows how to approximate the golden ratio via the Fibonacci series:"),Object(o.a)("pre",null,Object(o.a)("code",r({parentName:"pre"},{}),"fib(n+1) / fib(n) -> \u03c6 = 1.6180\u2026 \n")),Object(o.a)("p",null,"Or using C++\u2026"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"golden"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double")," epsilon",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"="),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0.00001"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," a ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double")," ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"while")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"tie"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," tuple",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," delta ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"a ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"(")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"abs"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"delta",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<")," epsilon ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," \n      ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"  \n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"main"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"golden"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"The function golden computes the golden ratio to a given approximation. On each iteration we get a little bit closer to the golden ratio, and the function returns once we are close enough."),Object(o.a)("p",null,"This was straightforward, but what if we have some additional use-cases for golden?"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Maybe we want to limit the maximum number of iterations")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Or maybe we want to print after every iteration")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Or maybe we want to return a tuple of { fib(n+1), fib(n) }")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Or maybe there is a use-case we haven\u2019t thought of yet, but someone might have down the line"))),Object(o.a)("p",null,"In order to satisfy all of these, we would need to modify the algorithm and provide some customization points. We could add a set of configuration options or perhaps use generic functions:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"template"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<"),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"class")," ",Object(o.a)("span",r({parentName:"code"},{className:"token class-name"}),"TestF")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"class")," ",Object(o.a)("span",r({parentName:"code"},{className:"token class-name"}),"Map"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),">"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"golden"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"TestF test",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," Map f",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," a ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double")," ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"while")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"tie"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," tuple",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," delta ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," b",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"a\u200a",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-"),"\u200aratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," b",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"test"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"delta",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," \n      ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"f"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"abs"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"delta",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"main"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," test ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),"i",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"="),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," delta",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," \u2026",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"mutable")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"++"),"i",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),">"),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"100")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"||")," delta",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<"),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0.0001"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"\n      ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token boolean"}),"true"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n \n    cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token boolean"}),"false"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," map ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," tuple",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"golden"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"test",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," map",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," a ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"We can see that the complexity of this function increased as we generalized it to handle more use-cases. This version of golden is much less readable than the original!"),Object(o.a)("p",null,"An alternative approach would have been to write a variant of this function for each specific use-case. Here\u2019s a version that prints each iteration:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"golden"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double")," epsilon",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"="),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0.00001"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," a ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double")," ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"while")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"tie"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," tuple",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," delta ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"a ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"(")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"abs"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"delta",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<")," epsilon ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," \n      ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"  \n")),Object(o.a)("p",null,"This would be readable, but now we have to maintain multiple functions!"),Object(o.a)("blockquote",null,Object(o.a)("h1",{parentName:"blockquote"},"How can we achieve reusability and simplicity?")),Object(o.a)("p",null,"Here\u2019s the problem. The templated version is flexible, but it is not simple. The function variants are simple, but not flexible. How can we achieve reusability and simplicity?"),Object(o.a)("h3",null,"Why do we have to choose between them at all?"),Object(o.a)("p",null,"This issue is caused by the fact that the algorithm controls the ",Object(o.a)("em",{parentName:"p"},"iteration of the sequence")," and ",Object(o.a)("em",{parentName:"p"},"representation of the sequence"),". These concerns should be separated."),Object(o.a)("p",null,"So what kind of abstraction do we need to have the get the best of both worlds?"),Object(o.a)("h2",null,"Inversion of Control via Coroutines TS"),Object(o.a)("p",null,"The Coroutines TS enables you to define lazy sequences. A lazy sequence is just an ordered set of values, where each value is only computes as it is requested."),Object(o.a)("p",null,"You might think of a lazy sequence as a container with two properties:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"bool hasNext() is there another value in this sequence?")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"T takeNext() return the next value in the sequence, and advance by 1."))),Object(o.a)("p",null,"As a result, we are able to decouple computation and representation, while maintaining full control over the sequence."),Object(o.a)("p",null,"The Coroutine TS is quite low-level, so the following examples are built using our ",Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/loopperfect/conduit"}),"Conduit")," library. This library gives us various primitives that we can use to create lazy sequences. We won\u2019t dive into the implementation details here (there is full ",Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/LoopPerfect/conduit"}),"source-code over on GitHub"),"), but instead look at how all of this is useful!"),Object(o.a)("p",null,"OK. So using ",Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/loopperfect/conduit"}),"Conduit")," we can define a lazy sequence for Fibonacci:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"fib"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"->")," seq",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<"),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),">")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," a ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," b ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"while")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"co_yield")," a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"tie"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," tuple",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," a",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+"),"b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"Since the golden ratios are a transformation of the Fibonacci numbers, we can compute them using a scan:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," fibRatios ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"fib"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),">>")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"scan"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," b",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{")," \n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," b",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"double"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(o.a)("p",null,"Here we use the sequence to print the first 10 Fibonacci-ratios:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"main"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," i ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"for")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," x",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),":")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"fibRatios"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"++"),"i ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"!=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"10"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"break"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"Now that we have an iterable, we can control the iteration by computing a delta as before:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"main")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," n",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"="),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"100"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," prevRatio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0.0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"for")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),":")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"fibRatios"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," delta ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," \u200aratio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-")," prevRatio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"n",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=="),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"||")," delta ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0.0001"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"\n      ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"break"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    prevRatio ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ratio",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    n",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-"),"\u200a",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-"),"\u200a",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"The beauty of this is that we can take just one definition of the sequence, but use it in multiple places. Unlike the templated solution we saw earlier, the code still maps closely to the mathematical definition."),Object(o.a)("p",null,"If you are curious how to implement lazy sequences using the Coroutine TS,\ncheckout our ",Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/loopperfect/conduit"}),"GitHub"),"."),Object(o.a)("h2",null,"Conclusion"),Object(o.a)("p",null,"The Coroutines TS allows us to give control back to the consumer of an algorithm. This frees the implementer from providing customization hooks to the end-user to modify the behaviour of the algorithm."),Object(o.a)("h2",null,"Since You\u2019re Here\u2026"),Object(o.a)("p",null,"We recently announced ",Object(o.a)("a",r({parentName:"p"},{href:"https://buildinfer.loopperfect.com/"}),"BuildInfer"),", a new tool to optimize your C/C++ build scripts. ",Object(o.a)("a",r({parentName:"p"},{href:"https://buildinfer.loopperfect.com/"}),"Take a look"),"!"),Object(o.a)("p",null,Object(o.a)("img",r({parentName:"p"},{src:"https://cdn-images-1.medium.com/max/2000/1*pkwieX1RSK5S0LXbFyaEJg.png",alt:null}))),Object(o.a)("h2",null,"You might also be interested in\u2026"),Object(o.a)("p",null,Object(o.a)("a",r({parentName:"p"},{href:"https://hackernoon.com/error-handling-in-c-or-why-you-should-use-eithers-in-favor-of-exceptions-and-error-codes-f0640912eb45"}),Object(o.a)("strong",{parentName:"a"},"Error Handling in C++ or: Why You Should Use Eithers in Favor of Exceptions and Error-codes"),Object(o.a)("em",{parentName:"a"},"TL;DR"),"hackernoon.com"),"\n",Object(o.a)("a",r({parentName:"p"},{href:"https://hackernoon.com/value-ptr-the-missing-c-smart-pointer-1f515664153e"}),Object(o.a)("strong",{parentName:"a"},"value_ptr \u2014 The Missing C++ Smart-pointer"),Object(o.a)("em",{parentName:"a"},"TL;DR"),"hackernoon.com")))}l.isMDXComponent=!0},yQAf:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/c-coroutine-ts-its-about-inversion-of-control",function(){return t("YoLn")}])}},[["yQAf",0,2,1,3,4]]]);