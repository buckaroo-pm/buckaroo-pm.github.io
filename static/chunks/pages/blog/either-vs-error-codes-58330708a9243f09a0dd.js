_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[18],{"+XCr":function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/either-vs-error-codes",function(){return t("tXJT")}])},tXJT:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return m})),t.d(a,"default",(function(){return u}));var n=t("rePB"),c=t("Ff2n"),o=(t("q1tI"),t("7ljp")),s=t("ZDfL");function p(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function r(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?p(Object(t),!0).forEach((function(a){Object(n.a)(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}var m={title:"Error Handling in C++ or: Why You Should Use Eithers in Favor of Exceptions and Error-codes",banner:"/posts/forrest.jpeg",author:"Team Buckaroo",created:"2017-05-16T11:00:00.000Z",__resourcePath:"blog/either-vs-error-codes.md",__scans:{},layout:"index"},N={frontMatter:m},l=s.a;function u(e){var a=e.components,t=Object(c.a)(e,["components"]);return Object(o.a)(l,r(r(r({},N),t),{},{components:a,mdxType:"MDXLayout"}),Object(o.a)("h2",null,"TL;DR"),Object(o.a)("p",null,"Consider using an Either type to handle errors as they lift the error into the type-system and have the same performance characteristics as error-codes."),Object(o.a)("h3",null,"Either Implementations"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/loopperfect/neither"}),"loopperfect/neither"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4109.pdf"}),"std::expected"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"https://ned14.github.io/boost.outcome/md_doc_md_02-tutorial_a.html"}),"boost::expected"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/beark/ftl"}),"beark/ftl")))),Object(o.a)("h2",null,"Introduction"),Object(o.a)("p",null,"Programming language design is always a matter of trade-offs. In the case of C++, the designers optimized for two things: ",Object(o.a)("em",{parentName:"p"},"runtime efficiency")," and ",Object(o.a)("em",{parentName:"p"},"high-level abstraction"),". This gives the C++ programmer huge flexibility in many areas, one of which is error handling."),Object(o.a)("h2",null,"Exceptions & Try-Catch"),Object(o.a)("p",null,"Try-catch is traditionally seen as the most idomatic error-handling method in C++."),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token macro property"}),Object(o.a)("span",r({parentName:"span"},{className:"token directive-hash"}),"#"),Object(o.a)("span",r({parentName:"span"},{className:"token directive keyword"}),"include")," ",Object(o.a)("span",r({parentName:"span"},{className:"token string"}),"<iostream>")),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token macro property"}),Object(o.a)("span",r({parentName:"span"},{className:"token directive-hash"}),"#"),Object(o.a)("span",r({parentName:"span"},{className:"token directive keyword"}),"include")," ",Object(o.a)("span",r({parentName:"span"},{className:"token string"}),"<string>")),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"divide"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," y",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"y ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"==")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"throw")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"string"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"Divide by zero"'),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"/")," y",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"main"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"try")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"4/2 "')," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"divide"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"4"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"2"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"3/0 "')," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"divide"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"3"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"catch"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"string e",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," e ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("h3",null,"Exception Overhead"),Object(o.a)("p",null,"The try-catch language feature is not zero-cost and the exact price is determined by the compiler implementation. Implementers can choose between increased code-size and increased run-time overhead, both in the success branch and the failure branch."),Object(o.a)("p",null,"In most C++ implementations, an interesting choice has been made: code in the try block runs as fast as any other code. However, dispatching to the catch block is orders of magnitude slower. This penalty grows linearly with the depth of the call-stack."),Object(o.a)("p",null,"If exceptions make sense for your project will depend on the frequency at which exceptions will be thrown. If the error rate is above 1%, then the overhead will likely be greater than that of alternative approaches. (",Object(o.a)("a",r({parentName:"p"},{href:"https://youtu.be/XVofgKH-uu4?t=1h2m24s"}),"Source"),")"),Object(o.a)("p",null,"Exceptions are not supported by all platforms, and methods that throw cannot be easily understood by C."),Object(o.a)("h3",null,"Ergonomics"),Object(o.a)("p",null,"Exceptions are very easy to use and fairly easy to reason about. You can throw and catch exceptions at any point in your code, and the exception can even be an arbitrary type."),Object(o.a)("p",null,"The biggest drawback is that handling exceptions is not enforced by the type-system. Unlike, Java, for example, where exceptions must be caught by the caller, catching a C++ exception is optional. This means spotting all the unhandled exceptions during a code review will be challenging, and requires deep knowledge of all of the functions called."),Object(o.a)("h3",null,"But what about noexcept and throw?"),Object(o.a)("p",null,"A common misconception is that annotating functions with noexcept or throw can help."),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"compute"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"noexcept")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"compute"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"throw"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"exception",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"Unfortunately, noexcept and throw simply dictate that a call to std::terminate is made in the case where an unmentioned exception is thrown. ",Object(o.a)("em",{parentName:"p"},"This does not enforce any exception-handling at compile-time.")),Object(o.a)("p",null,"For example, these will compile and throw a run-time error!"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"foo"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"throw"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"throw")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"bar"'),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"bar"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"noexcept")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"throw")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"42"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// These compile fine, but on execution std::terminate is called and the program exits"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"main"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"try")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"foo"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"catch"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"main"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"try")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"bar"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"catch"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    \n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("h2",null,"Error-codes"),Object(o.a)("p",null,"Error-codes are ancient and used ",Object(o.a)("em",{parentName:"p"},"everywhere"),". For simplicity, let\u2019s assume error-codes are just integers, but they could be implemented as type-safe enums or even complex objects. For this discussion it won\u2019t really matter."),Object(o.a)("p",null,"There are 3 common forms of error-code implementations."),Object(o.a)("h3",null,"1. Error-codes as Return Values"),Object(o.a)("p",null,"This pattern is found in many C APIs as it is easy to implement and has no performance overhead, besides the error-handling itself."),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"const")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ERROR ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"const")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," SUCCESS ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"compute"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," input",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"*")," output",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"cond"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"input",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ERROR",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"else")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"*"),"output ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"computeOutput"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"input",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," SUCCESS",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// Usage"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," output",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," input",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," error ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"compute"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"input",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"&"),"output",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"error_handler"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"error",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"This pattern can be followed very dogmatically and it is easy to verify that all cases have been taken care of in a code-review. It is easy to write a C-friendly API using error-codes."),Object(o.a)("p",null,"Unfortunately it has some drawbacks:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Functional composition is hard. The return value is occupied by the error-code, so the result must be an out-variable, which makes the function impure.")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Out-parameters enforce a memory layout which is not optimizer friendly.")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Separating error-handling from the computation is difficult.")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Postponing error-handling requires the programmer to thread the error-code through the call-graph."))),Object(o.a)("h3",null,"2. Error-code as out-parameter"),Object(o.a)("p",null,"Swapping the semantics of the out-parameter and return value has no significant advantages, except perhaps a slightly cleaner API. In the case where the error-code can be omitted, the API usage is simplified and functional compositionality is made easier."),Object(o.a)("p",null,"This approach can be found in boost::asio (in fact boost::asio even makes it optional and falls back to throwing exceptions if no out-parameter is provided)."),Object(o.a)("h3",null,"3. Error Singletons"),Object(o.a)("p",null,"Error singletons have completely different ergonomics. They are mostly found in low-level libraries that are implementing a system-global state-machine, such as a driver. One prominent example is OpenGL."),Object(o.a)("p",null,"Using an error singleton looks like this:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," result ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"compute1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"input",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," result2 ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"compute2"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"result",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"has_errors"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"pop_error_message"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("p",null,"In this paradigm, the status of the driver must be queried at run-time through a separate function. This appears to give you more freedom since you can query for errors when it is most appropriate, enabling you to better separate concerns. This allows the user to write code that resembles exception-based code, but without the cost of automatic stack unwinding."),Object(o.a)("p",null,"Benefits for the API consumer:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Error-handling can be reduced over time to a minimum")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Having fewer error-handling branches yields better performance")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"No out-parameters are required, which increases functional compositionality")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Finalization can be performed manually when errors are found"))),Object(o.a)("p",null,"But there are some big caveats:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Singletons by design have shared state, thus writing thread-safe code is very hard")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"No shortcutting of computation pipelines as no stack-unwinding occurs")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"It is not clear which errors may be fired on which api-calls. The programmer must check the documentation.")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"The severity of errors, and to recover from them, might be unclear"))),Object(o.a)("h2",null,"So what about Eithers?"),Object(o.a)("p",null,"An Either type is a container which takes a single value of one of two different types. A simple implementation might look like this:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"template"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<"),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"class")," ",Object(o.a)("span",r({parentName:"code"},{className:"token class-name"}),"Left"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"class")," ",Object(o.a)("span",r({parentName:"code"},{className:"token class-name"}),"Right"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),">"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"struct")," ",Object(o.a)("span",r({parentName:"code"},{className:"token class-name"}),"Either")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"union")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    Left leftValue",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n    Right rightValue",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"bool")," isLeft",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(o.a)("p",null,"To run computations on the wrapped value, an Either can provide some useful methods: leftMap, rightMap and join."),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"leftMap transforms the leftValue to a new value if present, leaving a rightValue unchanged.")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"rightMap transforms the rightValueto a new value if present, leaving a leftValue unchanged.")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"join takes a transformation for both sides of the Either where both transformations result in the same type. This allows an Either to be unified and unwrapped."))),Object(o.a)("p",null,"This is much easier to understand in code!"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),"Either",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<"),"string",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),">")," myEither ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"left"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"hello"'),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// constructs a either containing a leftValue;"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"int")," count ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," myEither\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"rightMap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," num",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," num ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// adds 1 if rightValue is present"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"leftMap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," str",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," str ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"world"'),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),'// appends "world" if leftValue is present'),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"leftMap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," str",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," str",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"size"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"join"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// both sides have now the same type, lets join..."),"\n")),Object(o.a)("p",null,"Now we are able to lift the exceptions into the type-system:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// This... "),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"float")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"sqrt"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"float")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"throw")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"string"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"x should be >= 0"'),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"computeSqrt"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// ... can be transformed into this... "),"\nEither",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<"),"std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"string",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),",")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"float"),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),">")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"sqrt"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"float")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"if")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"0"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n    ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"left"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"x should be >=0"'),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"right"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"computeSqrt"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n")),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// And for the caller, the usage changes from this... "),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"try")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"float")," x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"sqrt"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-"),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n  std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"sqrt(x) = "')," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"catch"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"string x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{"),"\n  std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"error occurred: "')," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," x ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),"\n\n",Object(o.a)("span",r({parentName:"code"},{className:"token comment"}),"// ... to this... "),"\nstd",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"string msg ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"=")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"sqrt"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"-"),Object(o.a)("span",r({parentName:"code"},{className:"token number"}),"1"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"leftMap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," msg",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"error occurred: "')," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+")," msg",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"rightMap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," result",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token string"}),'"sqrt(x) = "')," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"+")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"to_string"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"result",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"\n  ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"join"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n\nstd",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"cout ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," msg ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"<<")," std",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"::"),"endl",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";"),"\n")),Object(o.a)("h3",null,"So what have we gained through this simple change?"),Object(o.a)("p",null,"We no longer need to pay for the overhead of exceptions and we have also encoded the exception-type into the function signature. This documents the error in the source-code and now the compiler will ensure that we handle the types properly."),Object(o.a)("p",null,"This is a big deal, and it illustrates how powerful the C++ language is."),Object(o.a)("h3",null,"So what are the drawbacks?"),Object(o.a)("p",null,"First, you will need to add an Either type to you project. It is best not to reinvent the wheel here, and fortunately there are ",Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/loopperfect/neither"}),"many")," ",Object(o.a)("a",r({parentName:"p"},{href:"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4109.pdf"}),"open-source")," ",Object(o.a)("a",r({parentName:"p"},{href:"https://ned14.github.io/boost.outcome/md_doc_md_02-tutorial_a.html"}),"implementations")," ",Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/beark/ftl"}),"available"),"."),Object(o.a)("p",null,"But what about performance? At first glance, it seems that every call to leftMap and rightMap will add a branch to the executable. In practice, the compiler is smart enough to optimize these away!"),Object(o.a)("p",null,"Take a look at ",Object(o.a)("a",r({parentName:"p"},{href:"https://godbolt.org/g/5f6mT9"}),"this Compiler Explorer project"),"; the branches of the various map calls dissappear."),Object(o.a)("p",null,"For example, you might have noticed the following identity:"),Object(o.a)("pre",r({},{className:"language-cpp"}),Object(o.a)("code",r({parentName:"pre"},{className:"language-cpp"}),"e",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"leftMap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"f",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"leftMap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"g",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")")," ",Object(o.a)("span",r({parentName:"code"},{className:"token operator"}),"==")," e",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"."),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"leftmap"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"["),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"]"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"auto")," x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"{")," ",Object(o.a)("span",r({parentName:"code"},{className:"token keyword"}),"return")," ",Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"g"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),Object(o.a)("span",r({parentName:"code"},{className:"token function"}),"f"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"("),"x",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),";")," ",Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),"}"),Object(o.a)("span",r({parentName:"code"},{className:"token punctuation"}),")"),"\n")),Object(o.a)("p",null,"And it turns out that the compiler does too. It combines both lambdas to inline the whole expression. After the optimization step, all abstractions are collapsed. Once complied, there is no significant difference between the error-code implementations and the either-based implementations."),Object(o.a)("h2",null,"Conclusion"),Object(o.a)("p",null,"Consider using an Either type to handle errors. They lift the error into the type-system, making them safer than exceptions whilst yielding the same performance characteristics as error-codes."),Object(o.a)("h2",null,"Resources"),Object(o.a)("h3",null,"Either Implementations"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/loopperfect/neither"}),"loopperfect/neither"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4109.pdf"}),"std::expected"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"https://ned14.github.io/boost.outcome/md_doc_md_02-tutorial_a.html"}),"boost::expected"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},Object(o.a)("a",r({parentName:"p"},{href:"https://github.com/beark/ftl"}),"beark/ftl")))),Object(o.a)("h3",null,"Benchmarking Error-codes vs Exceptions vs Eithers"),Object(o.a)("center",null,Object(o.a)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/XVofgKH-uu4",frameborder:"0",allowfullscreen:!0})),Object(o.a)("h3",null,"Return Values vs Out-Parameters"),Object(o.a)("center",null,Object(o.a)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/eR34r7HOU14",frameborder:"0",allowfullscreen:!0})),Object(o.a)("h3",null,"Some Code Samples"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Gist: ",Object(o.a)("a",r({parentName:"p"},{href:"https://gist.github.com/nikhedonia/db401285d9f3816e2a74d78c68dd4c6c"}),"https://gist.github.com/nikhedonia/db401285d9f3816e2a74d78c68dd4c6c"))),Object(o.a)("li",{parentName:"ul"},Object(o.a)("p",{parentName:"li"},"Assembly: ",Object(o.a)("a",r({parentName:"p"},{href:"https://godbolt.org/g/5f6mT9"}),"https://godbolt.org/g/5f6mT9")))))}u.isMDXComponent=!0}},[["+XCr",0,2,1,3,4]]]);