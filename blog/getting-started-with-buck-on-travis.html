<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"/><link rel="stylesheet" type="text/css" href="/prism.css"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/a0584ae5515792e72ab5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a0584ae5515792e72ab5.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-7d1613afc8c8f43cb50f.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ae3781fe50e43492a499.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.9b549cceddc4472f1953.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3e4ffec4bbf3a45ef50f.js" as="script"/><link rel="preload" href="/_next/static/chunks/c18d713dde5d8f274a9340ae8a63196292880c5e.7af0c42e7b17c91d2be5.js" as="script"/><link rel="preload" href="/_next/static/chunks/fe8ef1070ee43d1bcce443c3875737aef33fa79f.55d4b28eaf40fcb59af0.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/getting-started-with-buck-on-travis-48a0a68a220fbf8bc085.js" as="script"/></head><body><div id="__next"><div class="site"><div class="site"><div class="navigation"><div class="view row space-between"><div class="links"><a class="buckaroo" href="/">Buckaroo</a><a href="https://github.com/LoopPerfect/buckaroo/wiki" target="_blank">Docs</a><a href="/blog">Blog</a></div><div class="search"><input placeholder="search for a module..." value=""/><button class="fa fa-search fa-large"></button></div><iframe id="star-button" src="https://ghbtns.com/github-btn.html?user=LoopPerfect&amp;repo=buckaroo&amp;type=star&amp;count=true&amp;size=large" frameBorder="0" scrolling="0" width="160px" height="30px"></iframe></div></div><div></div><div style="width:100%;max-height:80vh;overflow:hidden"><img src="/posts/berlin.jpeg" style="width:100%"/></div><div class="banner white"><div class="view"><div><h1>Getting Started with Buck build on Travis CI</h1><div class="post"><p>Getting Started with Buck build on Travis CI</p><p><a href="https://travis-ci.org/">Travis CI</a> is a service that offers free build servers for open-source projects (<a href="https://www.crunchbase.com/organization/travis-ci/timeline#/timeline/index">thanks, VCs!</a>). It has tight integration with GitHub, allowing you to automatically build and test code in a pull request before merging. This is great for projects with multiple contributors, because you can run tests without checking-out the code yourself.</p><p>But how do you integrate a <a href="https://buckbuild.com/">Buck</a> based project with Travis CI?</p><p>To follow this guide you will need the following:</p><ul><li><p>A <a href="https://github.com/njlr/buck-cxx-hello-world">GitHub project</a> that builds with Buck</p></li><li><p>An account on <a href="https://travis-ci.org/">Travis CI</a></p></li></ul><h3>TL;DR</h3><p>Grab the relevant files from the <a href="https://github.com/njlr/buck-travis-example">example repo on GitHub</a>.</p><h3>Create a .travis.yml File</h3><p>At the heart of a Travis project is the .travis.yml file. This is a YAML file that defines the build steps and build environment for your project. The most important property is script, which is the list of Bash commands.</p><p>For example:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">dist</span><span class="token punctuation">:</span> trusty
<span class="token key atrule">language</span><span class="token punctuation">:</span> generic

<span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ./build.sh
</code></pre><h3>Install Build Dependencies</h3><p>Buck is not packaged with any of the Travis system images, so we will need to add an installation step to the Travis file. Installation steps live under the before_install element.</p><p>The easiest way to get Buck running on Linux is via <a href="http://linuxbrew.sh/">Linuxbrew</a>, the Linux port of <a href="https://brew.sh/">Homebrew</a>. Like Homebrew, Linuxbrew allows us to easily install packages in userland, and it is mostly package-compatibile.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">before_install</span><span class="token punctuation">:</span>
  <span class="token comment"># Install Linuxbrew</span>
  <span class="token punctuation">-</span> git clone https<span class="token punctuation">:</span>//github.com/Linuxbrew/brew.git $HOME/.linuxbrew
  <span class="token punctuation">-</span> PATH=&quot;$HOME/.linuxbrew/bin<span class="token punctuation">:</span>$PATH&quot;
  <span class="token punctuation">-</span> echo &#x27;export PATH=&quot;$HOME/.linuxbrew/bin<span class="token punctuation">:</span>$PATH&quot;&#x27; <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span>~/.bash_profile
  <span class="token punctuation">-</span> export MANPATH=&quot;$(brew <span class="token punctuation">-</span><span class="token punctuation">-</span>prefix)/share/man<span class="token punctuation">:</span>$MANPATH&quot;
  <span class="token punctuation">-</span> export INFOPATH=&quot;$(brew <span class="token punctuation">-</span><span class="token punctuation">-</span>prefix)/share/info<span class="token punctuation">:</span>$INFOPATH&quot;
  <span class="token punctuation">-</span> brew <span class="token punctuation">-</span><span class="token punctuation">-</span>version
  <span class="token comment"># Install Buck</span>
  <span class="token punctuation">-</span> brew tap facebook/fb
  <span class="token punctuation">-</span> brew install buck
  <span class="token punctuation">-</span> buck <span class="token punctuation">-</span><span class="token punctuation">-</span>version
</code></pre><p>This snippet runs before the project is built. First, it installs Linuxbrew, then it uses Linuxbrew to install Buck.</p><p>You might have noticed that we <em>did not</em> use the provided Linuxbrew install script. This is because it is best to keep everything in the home folder, which ensures that the Travis user has read and write access.</p><p>Once we have Buck installed, the script portion of .travis.yml can call Buck:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> buck build <span class="token punctuation">:</span>hello
</code></pre><p>Pulling everything together, we have the following:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">dist</span><span class="token punctuation">:</span> trusty
<span class="token key atrule">language</span><span class="token punctuation">:</span> generic

<span class="token key atrule">before_install</span><span class="token punctuation">:</span>
  <span class="token comment"># Install Linuxbrew</span>
  <span class="token punctuation">-</span> git clone https<span class="token punctuation">:</span>//github.com/Linuxbrew/brew.git $HOME/.linuxbrew
  <span class="token punctuation">-</span> PATH=&quot;$HOME/.linuxbrew/bin<span class="token punctuation">:</span>$PATH&quot;
  <span class="token punctuation">-</span> echo &#x27;export PATH=&quot;$HOME/.linuxbrew/bin<span class="token punctuation">:</span>$PATH&quot;&#x27; <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span>~/.bash_profile
  <span class="token punctuation">-</span> export MANPATH=&quot;$(brew <span class="token punctuation">-</span><span class="token punctuation">-</span>prefix)/share/man<span class="token punctuation">:</span>$MANPATH&quot;
  <span class="token punctuation">-</span> export INFOPATH=&quot;$(brew <span class="token punctuation">-</span><span class="token punctuation">-</span>prefix)/share/info<span class="token punctuation">:</span>$INFOPATH&quot;
  <span class="token punctuation">-</span> brew <span class="token punctuation">-</span><span class="token punctuation">-</span>version
  <span class="token comment"># Install Buck</span>
  <span class="token punctuation">-</span> brew tap facebook/fb
  <span class="token punctuation">-</span> brew install buck
  <span class="token punctuation">-</span> buck <span class="token punctuation">-</span><span class="token punctuation">-</span>version

<span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> buck build <span class="token punctuation">:</span>hello
</code></pre><p>Add this file to the root of your project, and be sure to change the buck build command to point to the correct Buck target!</p><h3>Connect Travis CI to GitHub</h3><p>Once the Travis file is in place, you need to connect Travis CI to your GitHub project. <a href="https://travis-ci.org/">Create an account on Travis CI</a>, then flick the switch on the project you want to integrate.</p><p><img src="/posts/travis-toggles.png"/></p><p>Travis will now be integrated with your project, and it will start building master. You will also notice useful notifications appear in your pull requests!</p><h3>Accelerating the Build</h3><p>The build will take a while because it has to install all of the dependencies each time! We can improve this massively by taking advantage of Travis CI’s cache feature.</p><p>Travis CI allows you to mark a directory as cached, which means it gets re-used between builds. Since we installed Linuxbrew in userland, we can just cache the whole ~/.linuxbrew directory. On subsequent builds, Linuxbrew will detect that our dependencies are already installed and skip the installation step.</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">cache</span><span class="token punctuation">:</span>
  <span class="token key atrule">directories</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> $HOME/.linuxbrew/
</code></pre><p>We also need to make sure that we do not git clone Linuxbrew twice:</p><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">before_install</span><span class="token punctuation">:</span>
  <span class="token comment"># Install Linuxbrew</span>
    <span class="token punctuation">-</span> test <span class="token punctuation">-</span>d $HOME/.linuxbrew/bin <span class="token punctuation">|</span><span class="token punctuation">|</span> git clone https<span class="token punctuation">:</span>//github.com/Linuxbrew/brew.git $HOME/.linuxbrew
</code></pre><p>Pulling everything together gives us the finished Travis file:</p><pre class="language-yaml"><code class="language-yaml">
<span class="token key atrule">dist</span><span class="token punctuation">:</span> trusty
<span class="token key atrule">language</span><span class="token punctuation">:</span> generic

<span class="token key atrule">before_install</span><span class="token punctuation">:</span>
  <span class="token comment"># Install Linuxbrew</span>
  <span class="token punctuation">-</span> test <span class="token punctuation">-</span>d $HOME/.linuxbrew/bin <span class="token punctuation">|</span><span class="token punctuation">|</span> git clone https<span class="token punctuation">:</span>//github.com/Linuxbrew/brew.git $HOME/.linuxbrew
  <span class="token punctuation">-</span> PATH=&quot;$HOME/.linuxbrew/bin<span class="token punctuation">:</span>$PATH&quot;
  <span class="token punctuation">-</span> echo &#x27;export PATH=&quot;$HOME/.linuxbrew/bin<span class="token punctuation">:</span>$PATH&quot;&#x27; <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span>~/.bash_profile
  <span class="token punctuation">-</span> export MANPATH=&quot;$(brew <span class="token punctuation">-</span><span class="token punctuation">-</span>prefix)/share/man<span class="token punctuation">:</span>$MANPATH&quot;
  <span class="token punctuation">-</span> export INFOPATH=&quot;$(brew <span class="token punctuation">-</span><span class="token punctuation">-</span>prefix)/share/info<span class="token punctuation">:</span>$INFOPATH&quot;
  <span class="token punctuation">-</span> brew <span class="token punctuation">-</span><span class="token punctuation">-</span>version
  <span class="token comment"># Install Buck</span>
  <span class="token punctuation">-</span> brew tap facebook/fb
  <span class="token punctuation">-</span> brew install buck
  <span class="token punctuation">-</span> buck <span class="token punctuation">-</span><span class="token punctuation">-</span>version

<span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> buck build <span class="token punctuation">:</span>hello

<span class="token key atrule">branches</span><span class="token punctuation">:</span>
  <span class="token key atrule">except</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> gh<span class="token punctuation">-</span>pages

<span class="token key atrule">cache</span><span class="token punctuation">:</span>
  <span class="token key atrule">directories</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> $HOME/.linuxbrew/
</code></pre><h3>Conclusion</h3><p>And that’s it! The full Travis file should be enough to get started, or you can grab the relevant files from the <a href="https://github.com/njlr/buck-travis-example">example repo on GitHub</a>.</p><p><img src="https://cdn-images-1.medium.com/max/2272/1*0hqOaABQ7XGPT-OYNgiUBg.png"/></p><p><img src="https://cdn-images-1.medium.com/max/2272/1*Vgw1jkA6hgnvwzTsfMlnpg.png"/></p><p><img src="https://cdn-images-1.medium.com/max/2272/1*gKBpq1ruUi0FVK2UM_I4tQ.png"/></p><blockquote><p><a href="http://bit.ly/Hackernoon">Hacker Noon</a> is how hackers start their afternoons. We’re a part of the <a href="http://bit.ly/atAMIatAMI">@AMI</a> family. We are now <a href="http://bit.ly/hackernoonsubmission">accepting submissions</a> and happy to <a href="mailto:partners@amipublications.com">discuss advertising &amp; sponsorship</a> opportunities.
If you enjoyed this story, we recommend reading our <a href="http://bit.ly/hackernoonlatestt">latest tech stories</a> and <a href="https://hackernoon.com/trending">trending tech stories</a>. Until next time, don’t take the realities of the world for granted!</p></blockquote><p><img src="https://cdn-images-1.medium.com/max/30000/1*35tCjoPcvq6LbB3I6Wegqw.jpeg"/></p></div></div></div></div><div class="banner footer"><div class="view column"><div class="actions"><div class="links"><a href="/">Buckaroo</a><a href="https://github.com/LoopPerfect/buckaroo/wiki" target="_blank">Docs</a><a href="https://github.com/LoopPerfect/buckaroo" target="_blank">GitHub</a></div><div class="signup"><h1 class="action">Sign up for our Newsletter</h1><div class="info">Get the latest updates about new packages and Buckaroo releases.</div><button>Sign Up</button></div></div><div class="powered"><img src="/LoopPerfectInvertSmall.png"/><span>Powered by LoopPerfect</span></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/getting-started-with-buck-on-travis","query":{},"buildId":"XEnVUsOG7VkTdg59Wro6f","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-617a3a2c770be2525c7f.js"></script><script src="/_next/static/chunks/main-7d1613afc8c8f43cb50f.js" async=""></script><script src="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/_next/static/chunks/framework.ae3781fe50e43492a499.js" async=""></script><script src="/_next/static/chunks/commons.9b549cceddc4472f1953.js" async=""></script><script src="/_next/static/chunks/pages/_app-3e4ffec4bbf3a45ef50f.js" async=""></script><script src="/_next/static/chunks/c18d713dde5d8f274a9340ae8a63196292880c5e.7af0c42e7b17c91d2be5.js" async=""></script><script src="/_next/static/chunks/fe8ef1070ee43d1bcce443c3875737aef33fa79f.55d4b28eaf40fcb59af0.js" async=""></script><script src="/_next/static/chunks/pages/blog/getting-started-with-buck-on-travis-48a0a68a220fbf8bc085.js" async=""></script><script src="/_next/static/XEnVUsOG7VkTdg59Wro6f/_buildManifest.js" async=""></script><script src="/_next/static/XEnVUsOG7VkTdg59Wro6f/_ssgManifest.js" async=""></script></body></html>